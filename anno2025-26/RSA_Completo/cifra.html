<html>
<body>
<h1> inserisci il dato da cifrare </h1>

<!--<form action="http://127.0.0.1/5di/operazioniPOST.php" method="post">
dato 1: <input type="text" name="dato1"><br>
dato 2: <input type="text" name="dato2"><br>
<input type="submit" value="invia i dati al server ">
</form>-->
<form action="decifra.php" method="post">
    dato : <input type="text" id="datoDaCifrare" name="daCifrare"><br>
    CIFRATO : <input readonly type="text" id="Cifrato" name="cifrato"><br>
    <input type="button" onclick="cifra()" value="cifra">
    <input type="submit" value="invia i dati al server ">
</form>
<script>
    var xmlhttp = new XMLHttpRequest();
    function cifra() {
        let dato= document.getElementById("datoDaCifrare").value;
        let bin="";
        let cifrato=[]; 
        kpub(function(key){
             for(let i =0; i<dato.length; i++){
            cifrato.push(modPow(BigInt(dato[i].charCodeAt(0)), BigInt(key.e), BigInt(key.n)));
            }document.getElementById("Cifrato").value += cifrato.join(',') ;
        });

    }
    function kpub(callback) {
    xmlhttp.open("GET", "kpub.json", true);
    xmlhttp.send();
    xmlhttp.onreadystatechange = function () {
        if (this.readyState == 4 && this.status == 200) {
            var myObj = JSON.parse(this.responseText);
            const obj = {e:myObj.e , n:myObj.n};
            callback(obj);
        }
    };
};
function modPow(base, exp, mod) {
    let result = 1n;
    base = base % mod;

    while (exp > 0n) {
        if (exp % 2n === 1n) {
            result = (result * base) % mod;
        }
        exp = exp / 2n;
        base = (base * base) % mod;
    }
    return result;
}

</script>
</body>
</html> 